import { type SystemDatabase } from './system_database';
import { type GetWorkflowsInput, type StepInfo, type WorkflowHandle, type WorkflowStatus } from './workflow';
import { DBOSSerializer } from './serialization';
import { Pool } from 'pg';
/**
 * EnqueueOptions defines the options that can be passed to the `enqueue` method of the DBOSClient.
 * This includes parameters like queue name, workflow name, workflow class name, and other optional settings.
 */
interface ClientEnqueueOptions {
    /**
     * The name of the queue to which the workflow will be enqueued.
     */
    queueName: string;
    /**
     * The name of the method that will be invoked when the workflow runs.
     */
    workflowName: string;
    /**
     * The name of the class containing the method that will be invoked when the workflow runs.
     * If not provided, an empty string will be used as the class name.
     */
    workflowClassName?: string;
    /**
     * The name of the ConfiguredInstance containing the method that will be invoked when the workflow runs.
     * If not provided, an empty string will be used as the configured instance name.
     */
    workflowConfigName?: string;
    /**
     * An optional identifier for the workflow to ensure idempotency.
     * If not provided, a new UUID will be generated.
     */
    workflowID?: string;
    /**
     * The application version associated with this workflow.
     * If not provided, the version of the DBOS app that first dequeues the workflow will be used.
     */
    appVersion?: string;
    /**
     * Timeout for the workflow execution in milliseconds.
     * Note, timeout starts when the workflow is dequeued.
     * If not provided, the workflow timeout will not be set and the workflow will run to completion.
     */
    workflowTimeoutMS?: number;
    /**
     * An ID used to identify enqueues workflows that will be used for de-duplication.
     * If not provided, no de-duplication will be performed.
     */
    deduplicationID?: string;
    /**
     * An optional priority for the workflow.
     * Workflows with higher priority will be dequeued first.
     */
    priority?: number;
    /**
     * Partition key for partitioned queues.
     * Required when enqueueing on a partitioned queue.
     */
    queuePartitionKey?: string;
}
export declare class ClientHandle<R> implements WorkflowHandle<R> {
    readonly systemDatabase: SystemDatabase;
    readonly workflowUUID: string;
    constructor(systemDatabase: SystemDatabase, workflowUUID: string);
    getWorkflowUUID(): string;
    get workflowID(): string;
    getStatus(): Promise<WorkflowStatus | null>;
    getResult(): Promise<R>;
    getWorkflowInputs<T extends unknown[]>(): Promise<T>;
}
/**
 * DBOSClient is the main entry point for interacting with the DBOS system.
 */
export declare class DBOSClient {
    readonly serializer: DBOSSerializer;
    private readonly logger;
    private readonly systemDatabase;
    private constructor();
    /**
     * Creates a new instance of the DBOSClient.
     * @param databaseUrl - The connection string for the database. This should include the hostname, port, username, password, and database name.
     * @param systemDatabase - An optional name for the system database. If not provided, it defaults to the application database name with a `_dbos_sys` suffix.
     * @returns A Promise that resolves with the DBOSClient instance.
     */
    static create({ systemDatabaseUrl, systemDatabasePool, serializer, }: {
        systemDatabaseUrl: string;
        systemDatabasePool?: Pool;
        serializer?: DBOSSerializer;
    }): Promise<DBOSClient>;
    /**
     * Destroys the underlying database connection.
     * This should be called when the client is no longer needed to clean up resources.
     * @returns A Promise that resolves when database connection is destroyed.
     */
    destroy(): Promise<void>;
    /**
     * Enqueues a workflow for execution.
     * @param options - Options for the enqueue operation, including queue name, workflow name, and other parameters.
     * @param args - Arguments to pass to the workflow upon execution.
     * @returns A Promise that resolves when the message has been sent.
     */
    enqueue<T extends (...args: any[]) => Promise<any>>(options: ClientEnqueueOptions, ...args: Parameters<T>): Promise<WorkflowHandle<Awaited<ReturnType<T>>>>;
    /**
     * Sends a message to a workflow, identified by destinationID.
     * @param destinationID - The ID of the destination workflow.
     * @param message - The message to send. This can be any serializable object.
     * @param topic - An optional topic to send the message to. If not provided, the default topic will be used.
     * @param idempotencyKey - An optional idempotency key to ensure that the message is only sent once.
     * @returns A Promise that resolves when the message has been sent.
     */
    send<T>(destinationID: string, message: T, topic?: string, idempotencyKey?: string): Promise<void>;
    /**
     * Retrieves an event published by workflowID for a given key.
     * @param workflowID - The ID of the workflow that published the event.
     * @param key - The key associated with the event you want to retrieve.
     * @param timeoutSeconds - Timeout in seconds for how long to wait for the event to be available; default 60 seconds.
     * @returns A Promise that resolves with the event payload.
     */
    getEvent<T>(workflowID: string, key: string, timeoutSeconds?: number): Promise<T | null>;
    /**
     * Retrieves a single workflow by its id.
     * @param workflowID - The ID of the workflow to retrieve.
     * @returns a WorkflowHandle that represents the retrieved workflow.
     */
    retrieveWorkflow<T = unknown>(workflowID: string): WorkflowHandle<Awaited<T>>;
    cancelWorkflow(workflowID: string): Promise<void>;
    resumeWorkflow(workflowID: string): Promise<void>;
    forkWorkflow(workflowID: string, startStep: number, options?: {
        newWorkflowID?: string;
        applicationVersion?: string;
        timeoutMS?: number;
    }): Promise<string>;
    getWorkflow(workflowID: string): Promise<WorkflowStatus | undefined>;
    listWorkflows(input: GetWorkflowsInput): Promise<WorkflowStatus[]>;
    listQueuedWorkflows(input: GetWorkflowsInput): Promise<WorkflowStatus[]>;
    listWorkflowSteps(workflowID: string): Promise<StepInfo[] | undefined>;
    /**
     * Read values from a stream as an async generator.
     * This function reads values from a stream identified by the workflowID and key,
     * yielding each value in order until the stream is closed or the workflow terminates.
     * @param workflowID - The ID of the workflow that wrote to the stream
     * @param key - The stream key to read from
     * @returns An async generator that yields each value in the stream until the stream is closed
     */
    readStream<T>(workflowID: string, key: string): AsyncGenerator<T, void, unknown>;
}
export {};
//# sourceMappingURL=client.d.ts.map